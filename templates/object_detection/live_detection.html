{% extends "base/base.html" %}
{% load static %}

{% block title %}Live Detection{% endblock %}

{% block content %}
<div class="container mt-4">
    <h1 class="h3 mb-4">Live Detection</h1>

    <div class="row">
        <div class="col-md-8">
            <div class="card">
                <div class="card-header">
                    Live Video Feed
                </div>
                <div class="card-body p-0">
                    <img id="live-stream" src="" class="img-fluid" alt="Live Stream">
                </div>
            </div>
        </div>
        <div class="col-md-4">
            <div class="card">
                <div class="card-header">
                    Controls
                </div>
                <div class="card-body">
                    <div class="mb-3">
                        <label for="source-select" class="form-label">Select Camera Source</label>
                        <select id="source-select" class="form-select">
                            <option value="">-- Select a source --</option>
                            {% for source in sources %}
                            <option value="{% url 'object_detection:video_stream' source.id %}">{{ source.name }}</option>
                            {% endfor %}
                        </select>
                    </div>
                    <button id="start-btn" class="btn btn-success">Start Stream</button>
                    <button id="stop-btn" class="btn btn-danger" disabled>Stop Stream</button>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    const sourceSelect = document.getElementById('source-select');
    const liveStream = document.getElementById('live-stream');
    const startBtn = document.getElementById('start-btn');
    const stopBtn = document.getElementById('stop-btn');

    let streamUrl = '';

    sourceSelect.addEventListener('change', function() {
        streamUrl = this.value;
        if (streamUrl) {
            startBtn.disabled = false;
        } else {
            startBtn.disabled = true;
        }
    });

    startBtn.addEventListener('click', function() {
        if (streamUrl) {
            liveStream.src = streamUrl;
            startBtn.disabled = true;
            stopBtn.disabled = false;
            sourceSelect.disabled = true;
        }
    });

    stopBtn.addEventListener('click', function() {
        liveStream.src = '';
        startBtn.disabled = false;
        stopBtn.disabled = true;
        sourceSelect.disabled = false;
    });
});
</script>
{% endblock %}
